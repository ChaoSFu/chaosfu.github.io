<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
  <title>A股板块 & 核心个股（日更演示）</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📈</text></svg>">
  <link rel="stylesheet" href="./styles.css">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
  <main class="wrap">
    <!-- AI设置区域 -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h3 style="margin: 0; color: white; font-size: 18px;">🤖 AI量价分析</h3>
        <p style="margin: 4px 0 0 0; color: rgba(255,255,255,0.9); font-size: 13px;">
          <span id="current-model-display">当前模型：GPT-4o-mini</span>
          <span style="margin: 0 8px;">|</span>
          <span id="api-status-display">未配置API密钥</span>
        </p>
      </div>
      <button id="ai-settings-btn" style="padding: 10px 20px; background: white; color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
        ⚙️ AI配置
      </button>
    </div>

    <!-- 标签切换 -->
    <div class="tabs">
      <button class="tab active" data-tab="today">今日数据</button>
      <button class="tab" data-tab="recent10">近10日数据</button>
      <button class="tab" data-tab="history">历史趋势</button>
    </div>

    <!-- 今日数据 -->
    <div id="tab-today" class="tab-content active">
      <section>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
          <h2 style="margin: 0;">今日数据</h2>
          <small id="date" style="color: #666;"></small>
        </div>
        <p style="font-size: 0.875rem; color: #666; margin-bottom: 0.5rem;">
          排序依据：<strong>涨幅</strong>（从高到低） | 购买推荐基于：<strong>综合评分</strong>
          <button id="metrics-help-btn" style="background: none; border: 1px solid #999; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; color: #666; margin-left: 8px;">?</button>
        </p>
        <div id="metrics-help" style="display: none; background: #f5f5f5; border-left: 3px solid #4CAF50; padding: 12px; margin-bottom: 1rem; font-size: 0.85rem; line-height: 1.6;">
          <h3 style="margin: 0 0 8px 0; font-size: 0.95rem; color: #333;">📊 指标说明</h3>

          <p style="margin: 8px 0;"><strong>涨幅（ret）</strong><br>
          板块当日涨跌幅 = 收盘价 / 前收盘价 - 1</p>

          <p style="margin: 8px 0;"><strong>人气（pop）</strong><br>
          资金关注度 = Z(成交额放量) + 0.5 × Z(上涨家数)<br>
          <span style="color: #666; font-size: 0.8rem;">· 成交额放量 = 今日成交额 / 近5日平均成交额<br>
          · 上涨家数 = 板块内上涨个股数量</span></p>

          <p style="margin: 8px 0;"><strong>持续性（persistence）</strong><br>
          0-3分，评估板块强势的持续时间<br>
          <span style="color: #666; font-size: 0.8rem;">· 1日涨幅 > 0 得1分<br>
          · 近3日累计涨幅 > 0 得1分<br>
          · 近5日累计涨幅 > 0 得1分</span></p>

          <p style="margin: 8px 0;"><strong>分歧（dispersion）</strong><br>
          板块内个股涨幅的标准差，衡量走势一致性<br>
          <span style="color: #666; font-size: 0.8rem;">· 分歧度越小 → 个股走势越一致 → 板块得分越高<br>
          · 分歧度越大 → 个股分化严重 → 板块得分越低</span></p>

          <p style="margin: 8px 0;"><strong>综合分（score）</strong><br>
          多因子加权得分 = Z(涨幅) + Z(人气) + 0.5×Z(一致性)<br>
          <strong>用途：</strong>购买推荐依据（STRONG_BUY/BUY/WATCH/AVOID）<br>
          <span style="color: #666; font-size: 0.8rem;">· Z() 表示 Z-score 标准化，将不同指标归一到同一尺度<br>
          · 注意：榜单按涨幅排序，而非综合评分</span></p>

          <p style="margin: 8px 0;"><strong>🆕 NEW 标签</strong><br>
          标识新上榜板块，前10个交易日未进入前10，今日首次上榜<br>
          <span style="color: #666; font-size: 0.8rem;">· 表明该板块刚刚启动，可能具有介入价值<br>
          · 行业板块和概念板块分别独立计算</span></p>
        </div>
      </section>

      <section>
        <h3 style="margin-bottom: 1rem;">行业板块 Top 10</h3>
        <div id="industry-board-list"></div>
      </section>

      <section>
        <h3 style="margin-bottom: 1rem;">概念板块 Top 10</h3>
        <div id="concept-board-list"></div>
      </section>

      <section>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
          <h2 style="margin: 0;">主要指数看板</h2>
          <div style="display: flex; gap: 8px; align-items: center;">
            <button id="indices-help-btn" style="background: none; border: 1px solid #999; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; color: #666;">?</button>
            <button id="market-analyze-btn" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);">
              🎯 AI全市场分析
            </button>
          </div>
        </div>

        <div id="indices-help" style="display: none; background: #f5f9ff; border-left: 3px solid #2196F3; padding: 12px; margin-bottom: 1rem; font-size: 0.85rem; line-height: 1.6;">
          <h3 style="margin: 0 0 8px 0; font-size: 0.95rem; color: #333;">📈 指数介绍</h3>

          <p style="margin: 8px 0;"><strong>沪深300（大盘）</strong><br>
          沪深两市市值最大、流动性最好的300只股票，覆盖主要行业龙头<br>
          <span style="color: #666; font-size: 0.8rem;">· 特点：稳健、代表性强，反映A股整体走势<br>
          · 适用场景：市场中性阶段、机构配置主导，被动投资首选</span></p>

          <p style="margin: 8px 0;"><strong>中证500（中盘）</strong><br>
          在沪深300之外选取500只中盘股，多为行业细分龙头<br>
          <span style="color: #666; font-size: 0.8rem;">· 特点：均衡、成长性较好，介于大盘和小盘之间<br>
          · 适用场景：经济复苏初期、政策支持行业，分散化配置</span></p>

          <p style="margin: 8px 0;"><strong>中证1000（小盘）</strong><br>
          除沪深300和中证500外的1000只小盘成长股<br>
          <span style="color: #666; font-size: 0.8rem;">· 特点：高弹性、成长型，波动大、上涨空间大<br>
          · 适用场景：市场风险偏好回升、流动性宽松、题材炒作活跃</span></p>

          <p style="margin: 8px 0;"><strong>中证2000（微盘）</strong><br>
          除沪深300、中证500、中证1000外的2000只微小盘股<br>
          <span style="color: #666; font-size: 0.8rem;">· 特点：超高弹性，最活跃、波动最大<br>
          · 适用场景：极度宽松流动性、题材爆发、牛市后期</span></p>

          <p style="margin: 8px 0;"><strong>💡 量价关系</strong><br>
          成交额反映资金参与度，与涨跌幅结合可判断市场情绪：<br>
          <span style="color: #666; font-size: 0.8rem;">· 放量上涨：资金积极入场，趋势较强<br>
          · 缩量上涨：惜售心态，可能面临抛压<br>
          · 放量下跌：恐慌性抛售，可能见底信号<br>
          · 缩量下跌：观望情绪浓厚，尚未企稳</span></p>
        </div>
        <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">
          根据不同市值体量指数特征，判断当前市场风格和投资机会。点击"AI全市场分析"可一次性分析所有指数，识别风险与机会。
        </p>

        <!-- AI全市场分析结果 -->
        <div id="market-analysis-result" style="display: none; margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, #f6ffed 0%, #f0f9ff 100%); border: 1px solid #b7eb8f; border-radius: 12px;">
          <h3 style="margin: 0 0 12px 0; color: #333; font-size: 16px;">📊 AI市场分析结果</h3>
          <div id="market-analysis-content"></div>
        </div>

        <!-- 主要指数走势图 -->
        <div id="indices-dashboard" style="height: 400px; margin-top: 16px;"></div>

        <!-- 量价关系图 -->
        <div style="margin-top: 24px;">
          <h3 style="margin-bottom: 1rem;">量价关系分析</h3>
          <div id="volume-price-chart" style="height: 350px;"></div>
        </div>
      </section>

      <!-- AI设置弹窗 -->
      <div id="ai-settings-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: white; padding: 28px; border-radius: 12px; max-width: 600px; width: 90%; margin: 20px;">
          <h3 style="margin-top: 0; color: #333;">⚙️ AI分析设置</h3>
          <p style="font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 24px;">
            配置您的OpenAI API密钥和选择分析模型。所有设置仅保存在浏览器本地，不会上传到任何服务器。
          </p>

          <!-- API密钥配置 -->
          <div style="margin: 20px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">OpenAI API Key:</label>
            <input type="password" id="openai-api-key" placeholder="sk-proj-..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; font-family: monospace;">
            <p style="font-size: 12px; color: #999; margin-top: 6px;">
              💡 获取API密钥：访问 <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #1677ff;">platform.openai.com/api-keys</a>
            </p>
          </div>

          <!-- 模型选择 -->
          <div style="margin: 24px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">选择AI模型:</label>
            <select id="openai-model-select" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; cursor: pointer; background: white;">
              <optgroup label="🆕 GPT-5 系列（最新）">
                <option value="gpt-5">GPT-5 - 新一代旗舰 ($0.002/次)</option>
                <option value="gpt-5-mini">GPT-5 mini - 轻量版 ($0.0002/次)</option>
                <option value="gpt-5-nano">GPT-5 nano - 超轻量 ($0.00005/次)</option>
              </optgroup>
              <optgroup label="🧠 推理模型（Reasoning）">
                <option value="o3-mini">🆕 o3-mini - 新一代推理 ($0.001/次)</option>
                <option value="o1">o1 - 最强推理 ($0.015/次)</option>
                <option value="o1-mini">o1-mini - 快速推理 ($0.003/次)</option>
              </optgroup>
              <optgroup label="⭐ GPT-4o 系列（推荐）">
                <option value="gpt-4o">GPT-4o - 多模态旗舰 ($0.002/次)</option>
                <option value="gpt-4o-mini" selected>GPT-4o-mini - 高性价比 ($0.00015/次)</option>
              </optgroup>
              <optgroup label="GPT-4 系列">
                <option value="gpt-4.1">🆕 GPT-4.1 - 升级版 ($0.002/次)</option>
                <option value="gpt-4-turbo">GPT-4 Turbo - 长上下文 ($0.01/次)</option>
                <option value="gpt-4">GPT-4 - 标准版 ($0.03/次)</option>
              </optgroup>
              <optgroup label="GPT-3.5 系列">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo - 极致省钱 ($0.00005/次)</option>
              </optgroup>
            </select>
          </div>

          <!-- 模型对比信息 -->
          <div id="model-info-card" style="background: #f6f8fa; border: 1px solid #e1e4e8; border-radius: 8px; padding: 16px; margin: 20px 0; font-size: 13px; line-height: 1.6;">
            <div style="display: flex; align-items: center; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #333;">GPT-4o-mini</span>
              <span style="margin-left: 8px; padding: 2px 8px; background: #e6f7ff; color: #1677ff; border-radius: 4px; font-size: 11px;">推荐</span>
            </div>
            <div style="color: #666;">
              <div>💰 成本：约 $0.00015/次 (¥0.001)</div>
              <div style="font-size: 12px; color: #999; margin-top: 4px;">Input: $0.15/1M tokens | Output: $0.60/1M tokens</div>
              <div>⚡ 速度：很快（1-2秒）</div>
              <div>🎯 适用：日常量价分析，性价比极高</div>
            </div>
          </div>

          <!-- 按钮组 -->
          <div style="display: flex; gap: 12px; margin-top: 24px;">
            <button id="save-api-key" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s;">
              💾 保存配置
            </button>
            <button id="cancel-settings" style="flex: 1; padding: 12px; background: #f0f0f0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px; transition: all 0.3s;">
              取消
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 近10日数据 -->
    <div id="tab-recent10" class="tab-content">
      <section>
        <h2>近10个交易日数据</h2>
        <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">
          展示最近10个<strong>交易日</strong>的完整板块数据（不包括周末和节假日），每日数据包括行业板块、概念板块和市场指数
        </p>
        <div id="recent10-list"></div>
      </section>
    </div>

    <!-- 历史趋势 -->
    <div id="tab-history" class="tab-content">
      <section>
        <h2>指数 7 日走势</h2>
        <div id="indices-trend" style="height:280px"></div>
      </section>

      <section>
        <h2>市场节奏变化</h2>
        <div id="market-trend" style="height:200px"></div>
      </section>

      <section>
        <h2>热门板块（连续上榜）</h2>
        <div id="hot-boards"></div>
      </section>

      <section>
        <h2>板块轮动热力图</h2>
        <div id="board-rotation" style="height:350px"></div>
      </section>
    </div>

    <section>
      <h2>免责声明</h2>
      <p id="disclaimer" class="disclaimer"></p>
    </section>
  </main>

  <footer class="wrap">
    <small>© 2025 YourName. For research only.</small>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
